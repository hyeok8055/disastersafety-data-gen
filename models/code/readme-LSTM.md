# LSTM 기반 구호품 수량 예측 설명서

이 문서는 재난 상황에서 대피소별 구호품의 "얼마나 필요할지"를 예측하는 LSTM 모델을 쉽게 설명합니다. LSTM은 과거 데이터를 보고 미래를 예측하는 인공지능 모델입니다.

## 이 모델의 목적
- **무엇을 예측하나요?**: 특정 대피소와 구호품 조합의 앞으로 며칠 동안의 일별 소비량을 예측합니다.
- **왜 필요하나요?**: 재난 시 구호품을 미리 준비해서 낭비나 부족을 줄이기 위해.
- **범위**: 모델 만들기, 데이터 준비, 예측 실행, 결과 해석까지.

## 데이터와 파일 경로
- **원본 데이터**: `tools/output_csv/` 폴더의 CSV 파일들 (사용자, 대피소, 소비 기록 등).
- **학습 데이터**: `models/data/lstm_forecast/train.csv` (예측에 사용할 정리된 데이터).
- **모델 파일**: `models/data/lstm_forecast/model.keras` (학습된 모델).
- **예측 결과**: `models/data/lstm_forecast/predictions.json` (예측된 수량).

## 입력변수 (모델에 넣는 데이터)
모델은 과거 데이터를 보고 미래를 예측합니다. 입력변수는 "과거의 어떤 정보"를 의미합니다. 총 16개 정도의 변수가 들어갑니다.

### 1. 기본 소비량 관련 (숫자 데이터)
- **y_t**: 그날 실제로 소비된 구호품 개수 (예: 5개, 0개 등).
- **cons_ma7**: 최근 7일 동안의 평균 소비량 (소비가 안정적인지 보기 위해).
- **cons_ma14**: 최근 14일 평균.
- **cons_ma28**: 최근 28일 평균.

### 2. 상황 관련 (카테고리 데이터)
이건 계절, 재난 강도, 날씨 같은 상황을 나타내는 변수입니다. 예를 들어:
- **seasonality_summer**: 여름인지 (1이면 여름, 0이면 아니오).
- **disaster_severity_high**: 재난이 심한지 (1이면 심함, 0이면 약함).
- **weather_rain**: 비가 오는지 (1이면 비, 0이면 맑음).

이 변수들은 자동으로 데이터에서 찾아서 추가됩니다. 예측할 때는 학습 때 쓴 것과 똑같이 넣어야 합니다.

## 출력변수 (모델이 내놓는 결과)
모델이 예측한 결과를 말합니다.

- **일별 예측 소비량 (yhat)**: 앞으로 며칠 동안 매일 얼마나 소비될지 예측 (예: 1일차 0.5개, 2일차 0.6개).
- **권장 수량 (recommended_quantity)**: 예측된 총 소비량에 20% 여유를 더해서 올림한 값 (예: 총 2.5개 예측 → 3개 권장).

## 모델의 동작 원리 (간단히)
1. **데이터 준비**: 과거 28일 데이터를 모아서 모델에 넣습니다.
2. **예측**: 모델이 "내일은 얼마나 소비될까?"를 계산합니다. 그 다음 날도 계속 반복합니다.
3. **결과**: 일별 예측을 합쳐서 총 권장 수량을 만듭니다.

## 학습과 예측 방법
- **학습**: `python models/code/train_lstm.py` 실행 (데이터로 모델을 훈련).
- **예측**: `python models/code/predict_lstm.py --horizon 7` 실행 (7일 예측).
- **데모**: `python models/code/demo_recommend_with_quantity.py` (추천 품목 + 수량 함께 보기).

## 실제 예측 결과 예시
최근 실행한 결과:
- 대피소: SH_008766, 품목: relief_item_000322
- 7일 예측: 0.34개 → 0.38개 (완만히 증가).
- 총 합계: 약 2.55개, 여유 더해서 권장 수량: 4개.
- 해석: 이 조합은 소비가 적은 편. 재난 상황이나 날씨가 영향을 줬을 수 있음.

## 한계와 개선 아이디어
- 긴 기간 소비가 없으면 예측이 0에 가까워질 수 있음 → 데이터 변환(로그)로 개선 가능.
- 더 좋은 예측을 위해 요일, 인구 수 같은 추가 정보를 넣을 수 있음.
- 모델 튜닝: 학습 횟수 늘리기, dropout 조정.

## 파일 구조
- `train_lstm.py`: 모델 학습.
- `predict_lstm.py`: 예측 실행.
- `lstm_utils.py`: 도움 함수들.
- `demo_recommend_with_quantity.py`: 추천 + 수량 데모.

## 문제 해결
- 예측이 안 맞으면: 데이터 확인, 학습 다시 하기.
- 오류 나면: 메타 파일(`model.keras.meta.json`) 확인.

---
이 문서는 쉽게 이해하도록 간단히 썼습니다. 더 궁금한 점 있으면 물어보세요!
